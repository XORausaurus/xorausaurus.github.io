<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The C Compilation Process - Exploitation Freaks</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Exploitation</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="pwntools-debugging.html"><strong aria-hidden="true">2.1.</strong> Pwntools Debugging</a></li><li class="chapter-item expanded "><a href="cve-2015-3887.html"><strong aria-hidden="true">2.2.</strong> CVE-2015-3887</a></li><li class="chapter-item expanded "><a href="pwnkit.html"><strong aria-hidden="true">2.3.</strong> Deep Into Pwnkit - CVE-2021-4034</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.4.</strong> TetCTF 2022</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="newbie_tetctf.html"><strong aria-hidden="true">2.4.1.</strong> Newbie</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.5.</strong> Cyber Santa is Coming to Town</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="hackthebox-pwn-snowy.html"><strong aria-hidden="true">2.5.1.</strong> Mr Snowy</a></li><li class="chapter-item expanded "><a href="hackthebox-pwn-sleigh.html"><strong aria-hidden="true">2.5.2.</strong> Sleigh</a></li><li class="chapter-item expanded "><a href="hackthebox-pwn-naughty-list.html"><strong aria-hidden="true">2.5.3.</strong> Naughty List</a></li><li class="chapter-item expanded "><a href="hackthebox-pwn-minimelfistic.html"><strong aria-hidden="true">2.5.4.</strong> Minimelfistic</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.6.</strong> ROPEmporium</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="ropemporium-split.html"><strong aria-hidden="true">2.6.1.</strong> Split</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.7.</strong> NahamCon 2021</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="nahamcon_ret2basic.html"><strong aria-hidden="true">2.7.1.</strong> ret2basic</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.8.</strong> DownunderCTF 2020</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="return-to-what.html"><strong aria-hidden="true">2.8.1.</strong> return-to-what</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.9.</strong> Exploit.Education</div></li><li class="chapter-item expanded "><a href="exploit-education_stack-zero_arm.html"><strong aria-hidden="true">2.10.</strong> Stack-Zero (ARM64)</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Reverse Engineering</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="anatomy-of-a-gopher.html"><strong aria-hidden="true">3.1.</strong> Anatomy of a Gopher</a></li><li class="chapter-item expanded "><a href="gomalware-reversing-in-action.html"><strong aria-hidden="true">3.2.</strong> Go Malware Reverse Engineering with Kaspersky</a></li><li class="chapter-item expanded "><a href="license_checker_1.html"><strong aria-hidden="true">3.3.</strong> License Checker 0x01</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Arizona State University Notes</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="pwn-college-babyshell_level1.html"><strong aria-hidden="true">4.1.</strong> BabyShell Level 1</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="pwn-college-babyshell-level3.html"><strong aria-hidden="true">4.1.1.</strong> BabyShell Level 3</a></li><li class="chapter-item expanded "><a href="pwn-college-babyshell-level4.html"><strong aria-hidden="true">4.1.2.</strong> BabyShell Level 4</a></li><li class="chapter-item expanded "><a href="pwn-college-babyshell-level5.html"><strong aria-hidden="true">4.1.3.</strong> BabyShell Level 5</a></li><li class="chapter-item expanded "><a href="pwn-college-babyshell-level6.html"><strong aria-hidden="true">4.1.4.</strong> BabyShell Level 6</a></li><li class="chapter-item expanded "><a href="pwn-college-babyshell-level7.html"><strong aria-hidden="true">4.1.5.</strong> BabyShell Level 7</a></li><li class="chapter-item expanded "><a href="pwn-college-babyshell-level8.html"><strong aria-hidden="true">4.1.6.</strong> Babyshell Level 8</a></li><li class="chapter-item expanded "><a href="pwn-college-baby_reversing-5.html"><strong aria-hidden="true">4.1.7.</strong> BabyReverse Level 5</a></li><li class="chapter-item expanded "><a href="pwn-college-baby_reversing-10.html"><strong aria-hidden="true">4.1.8.</strong> BabyReverse Level 10</a></li><li class="chapter-item expanded "><a href="pwn-college-baby_reversing-13.html"><strong aria-hidden="true">4.1.9.</strong> BabyReverse Level 13</a></li><li class="chapter-item expanded "><a href="pwn-college-baby_reversing-15.html"><strong aria-hidden="true">4.1.10.</strong> BabyReverse Level 15</a></li><li class="chapter-item expanded "><a href="pwn-college-embryogdb-2.html"><strong aria-hidden="true">4.1.11.</strong> EmbryoGDB Level 2</a></li><li class="chapter-item expanded "><a href="pwn-college-embryogdb-3.html"><strong aria-hidden="true">4.1.12.</strong> EmbryoGDB Level 3</a></li><li class="chapter-item expanded "><a href="pwn-college-embryogdb-4.html"><strong aria-hidden="true">4.1.13.</strong> EmbryoGDB Level 4</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.</strong> Flare 8 (2021)</div></li><li class="chapter-item expanded "><a href="credchecker.html"><strong aria-hidden="true">4.3.</strong> credchecker</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="flare-on_known.html"><strong aria-hidden="true">4.3.1.</strong> known</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.4.</strong> Flare 7 (2020)</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="flare-on_garbage.html"><strong aria-hidden="true">4.4.1.</strong> garbage</a></li></ol></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> Programming</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">5.1.</strong> The Linux Programming Interface</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="programming-tee.html"><strong aria-hidden="true">5.1.1.</strong> Exercise 4.1 (reproducing the tee linux binary)</a></li></ol></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> Practical Binary Analysis Notes</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">6.1.</strong> Chapter 1</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="practical_binary_analysis_c1-1.html" class="active"><strong aria-hidden="true">6.1.1.</strong> The C Compilation Process</a></li><li class="chapter-item expanded "><a href="practical_binary_analysis_c1-2.html"><strong aria-hidden="true">6.1.2.</strong> Symbols and Stripped Binaries</a></li><li class="chapter-item expanded "><a href="practical_binary_analysis_c1-3.html"><strong aria-hidden="true">6.1.3.</strong> Disassembling a Binary</a></li></ol></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> Networking</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="mass-wificracking.html"><strong aria-hidden="true">7.1.</strong> Mass Wifi Cracking at Scale</a></li><li class="chapter-item expanded "><a href="half-handshake-crack.html"><strong aria-hidden="true">7.2.</strong> Half-Handshake Crack</a></li><li class="chapter-item expanded "><a href="tn-wn722n-monitor-mode.html"><strong aria-hidden="true">7.3.</strong> TN-WN722N Monitor Mode</a></li><li class="chapter-item expanded "><a href="awus036ach-monitor-mode.html"><strong aria-hidden="true">7.4.</strong> AWUS036ACH Monitor Mode</a></li><li class="chapter-item expanded "><a href="rpi-rtl88x2bu-evil-AP.html"><strong aria-hidden="true">7.5.</strong> RTL88x2bu Fake Access Point</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> Windows</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="windows-cheatsheet.html"><strong aria-hidden="true">8.1.</strong> Windows Cheatsheet</a></li><li class="chapter-item expanded "><a href="wireshark_weaponization.html"><strong aria-hidden="true">8.2.</strong> Wireshark Weaponization</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.</strong> HackTheBox</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="htb-paper.html"><strong aria-hidden="true">9.1.</strong> Paper</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.</strong> Other</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="irc.html"><strong aria-hidden="true">10.1.</strong> Join a IRC Server anonymously</a></li><li class="chapter-item expanded "><a href="docker.html"><strong aria-hidden="true">10.2.</strong> Docker Tricks</a></li><li class="chapter-item expanded "><a href="scan_faster.html"><strong aria-hidden="true">10.3.</strong> Quicker Port Scans with Masscan</a></li><li class="chapter-item expanded "><a href="bashfuscator.html"><strong aria-hidden="true">10.4.</strong> Bashfuscator</a></li><li class="chapter-item expanded "><a href="python_socketio.html"><strong aria-hidden="true">10.5.</strong> Python - Working with socket.io</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Exploitation Freaks</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="the-c-compilation-process"><a class="header" href="#the-c-compilation-process">The C Compilation Process</a></h1>
<p>Binaries goes through a process called <em>compilation</em>, which is the process of translating human readable source code, such as C or C++, into machine code that your processor can execute.</p>
<h4 id="1---preprocessing"><a class="header" href="#1---preprocessing">1 - Preprocessing</a></h4>
<p>Includes are included inside the main source file (library code), same thing with other header files and source files, macros definitions in code are replaced with the value of the macro instead of the name of this one, therefore any macros should lose it's symbolic name after preprocessing.</p>
<h4 id="2---compilation"><a class="header" href="#2---compilation">2 - Compilation</a></h4>
<p>When preprocessing is done, the source is ready to be compiled. Compilations consists of taking C/C++ source code and transforming it into assembly. (Most compilers also perform heavy optimization in this phase).</p>
<h4 id="3---assembly-phase"><a class="header" href="#3---assembly-phase">3 - Assembly Phase</a></h4>
<p>After compilation of our code into assembly, it's time to transform it into machine code. The input of the assembly phase is the set of assembly language files generated in the compilation phase, and the output is a set of <em>object files</em>, sometimes also referred to as <em>modules</em>. Object files contains machine instructions that are in principle executable by the processor.</p>
<p>GCC can be used to generate object files instead of ELF executable, this is easily done using the -c switch.</p>
<pre><code>$ gcc -c source.c
$ file source.o
source.o: ELF 64-bit LSB relocatable, x86-64, version 1 (SYSV), not stripped
</code></pre>
<p>What does <em>Relocatable</em> means ? Relocatable files don't rely on being placed at any particular address in memory; rather, they can be moved around at will without breaking any assumptions in the code. When you see the term <em>relocatable</em> in the <em>file</em> output, you know you are dealing with an object file and not an executable.</p>
<p>Object files are compiled independently from each other, so the assembler has no way of knowing the memory addresses of other object files when assembling an object file. That's why object files need to be relocatable; that way, you can link them together in any order to form a complete binary executable. If object files were not relocatable, this would not be possible.</p>
<h4 id="4---linking"><a class="header" href="#4---linking">4 - Linking</a></h4>
<p>The linking phase is the last and final phase of the ELF compilation process, this phase is responsible for linking all the generated object files from the last phase into a single ELF executable, in modern systems, the linking phase sometimes incorporates an additional optimization pass, called <em>link-time optimization (LTO).</em></p>
<p>The program responsible for linking the obect files is called the <em>linker</em>. It's typically seperate from the compiler.</p>
<p>Object files are relocatable because they are compiled independently from each other, preventing the compiler from assuming that an object will end up at any particular base address. Moreover, object files may reference functions or variables in other object files or in libraries that are external to the program (example libc). Before the linking phase the addresses at which the referenced code and data will be placed are not yet known, so the object files only contain <em>relocation symbols</em> that specify how function and variable references should eventually be resolved. In the context of linking, references that rely on a relocation are called <em>symbolic references</em>.</p>
<p>The linker's job is to take all the object files belonging to a program and merge them into a single coherent executable, typically intended to be loaded at a particular memory address. Now that the arrangement of all modules in the executable is known, the linker can resolve most symbolic references. References to libraries may or may not be completely resolved, depending on the type of library.</p>
<p>Static libraries (which on linux typically have the extension .a) are merged into the binary executable, allowing any references to them to be resolved entirely. There are also dynamic (shared) libraries, which are shared in memory among all programs that run on a system. In other words, rather than copying all the library into every binary that uses it, dynamic libraries are loaded into memory only once, and any binary that wants to use the library needs to use this shared copy. During the linking phase, the addresses at which dynamic libraries will reside are not yet known, so references to them cannot be resolved. Instead the linker leaves symbolic references to these libraries even in the final executable and these references are not resolved until the binary is actually loaded into memory to be executed.</p>
<p>You can see which dynamic linker and shared libraries will be used by your executable by running the ldd command on it (works only with dynamically linked libraries).</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="programming-tee.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="practical_binary_analysis_c1-2.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="programming-tee.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="practical_binary_analysis_c1-2.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
